# 2.15 - Auto scale

[Permalink](https://github.com/redhatbsb/test-drive-openshift/blob/8ce43c5cb511571d907947f2d78a595d00910586/parte-2-openshift-4x/auto-scale.adoc)

Cannot retrieve contributors at this time

 68 lines \(44 sloc\) 2.18 KB

## Auto Scale <a id="user-content-auto-scale"></a>

### Introdução <a id="user-content-introdu&#xE7;&#xE3;o"></a>

O Openshift suporta scale-out e scale-in da sua aplicação. Dessa forma, é possível que sejam criadas novas instâncias da sua aplicação sob demanda de modo automático e com base em algum critério como CPU ou memória. Uma vez que o pico de acesso tenha parado, sua aplicação volta para a quantidade de instâncias que existiam antes do scale-out.

Vamos preparar nossa aplicação para o autoscale.

### Preparando a aplicação <a id="user-content-preparando-a-aplica&#xE7;&#xE3;o"></a>

O Openshift suporte autoscale por CPU ou memória. Nesse lab iremos utilizar o critério de CPU para demonstração dessa funcionalidade.

Para criar o autoscale, execute o seguinte comando:

```text
oc autoscale dc/workshop-ocp --min 1 --max 3 --cpu-percent=10
```

### Estressando a aplicação <a id="user-content-estressando-a-aplica&#xE7;&#xE3;o"></a>

Vamos gerar uma carga agora na aplicação para ver como ela se comporta. Utilizaremo o [ab \(Apache Benchmark\)](https://httpd.apache.org/docs/2.4/programs/ab.html).

```text
ab -n 100000 -c 50 $(oc get --no-headers route workshop-ocp | awk '{print $2"/"}')
```

O Autoscale pode demorar um pouco para acontecer. Openshift demora aproximadamente 1 minuto para coletar as métricas necessárias para tomar uma decisão de escalar a aplicação.

### Acompanhando pela CLI <a id="user-content-acompanhando-pela-cli"></a>

Você pode acompanhar o uso de recursos e o auto scale por meio do comando:

| Note |  Como existe um terminal já sendo utilizado pelo `ab`, será necessário abrir outro terminal para acompanhar o que está acontendo. |
| :--- | :--- |


### Acompanhando pela Web Console <a id="user-content-acompanhando-pela-web-console"></a>

Você pode acompanhar o auto scale pela Web Console clicando em `Topology` no menu lateral esquerdo e depois em cima do círculo da aplicação.

### Scale in <a id="user-content-scale-in"></a>

A aplicação pode demorar em torno de uns 5 minutos para voltar as instâncias originais.

### Removendo o Auto Scale <a id="user-content-removendo-o-auto-scale"></a>

Ao final desse lab, precisamos remover o auto scale. Para isso, basta apagar o `HPA` com o comando abaixo:

```text
oc delete hpa workshop-ocp
```

