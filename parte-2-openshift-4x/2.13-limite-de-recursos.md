# 2.14 - Limite de recursos

[Permalink](https://github.com/redhatbsb/test-drive-openshift/blob/8ce43c5cb511571d907947f2d78a595d00910586/parte-2-openshift-4x/limite-de-recursos.adoc)

Cannot retrieve contributors at this time

 88 lines \(57 sloc\) 3.5 KB

## Limite de Recursos <a id="user-content-limite-de-recursos"></a>

### Introdução <a id="user-content-introdu&#xE7;&#xE3;o"></a>

O Openshift permite que você limite a quantidade de recursos que serão disponibilizados para sua aplicação. Antes de continuarmos esse assunto, é preciso esclarecer duas nomenclaturas

### Request vs Limit <a id="user-content-request-vs-limit"></a>

#### Request <a id="user-content-request"></a>

`Request` seria o equivalente ao valor mínimo de um determinado recurso. Esse campo é muito importante para o scheduler do Openshift. Toda vez que uma nova aplicação é criada, o Openshift escolhe automaticamente em qual nó do cluster ela irá rodar. Ele faz isso utilizando o valor do request como base para descobrir qual node tem o valor do request disponível.

#### Limit <a id="user-content-limit"></a>

`Limit` é o valor máximo de um determinado recurso que o Openshift permitirá ser utilizado. Esse campo também é importante pois evita que sua aplicação possa consumir mais recurso do que foi alocado. Situações como _Out of Memory_ acabam sendo minimizadas quando este valor está configurado corretamente.

### Configurando limites na nossa app <a id="user-content-configurando-limite-de-recursos-na-nossa-aplica&#xE7;&#xE3;o"></a>

Podemos limitar a quantidade de CPU e memória que nossa aplicação consumirá. Para isso, precisamos executar

```text
oc set resources deploymentconfig/workshop-ocp --limits=cpu=200m,memory=100Mi --requests=cpu=200m,memory=100Mi
```

Nesse caso estamos colocando os limites e requests conforme abaixo:

* **CPU - Request:** 200 milicores
* **CPU - Limit:** 200 milicores
* **Memory - Request:** 100 MiB
* **Memory - Limit:** 100 MiB

Estamos falando para o Openshift que nossa aplicação precisa de 20% \(200 milicores\) de 1 CPU livre para ser criada - somente nodes com essa condição receberão a aplicação - e que utilizará no máximo também 20% de 1 CPU.

O mesmo se aplica a memória. Openshift irá procurar nodes com 100 Megas de memória livres para colocar a aplicação e ela somente poderá usar 100 Megas de memória.

### Adaptando nossa aplicação <a id="user-content-adaptando-nossa-aplica&#xE7;&#xE3;o"></a>

Vamos agora executar um processo dentro do container que consuma todo recurso possível de memória e CPU. O comando abaixo faz exatamente essa tarefa:

```text
while :; do _+=( $((++__)) ); done
```

| Warning |  Use o comando acima com cuidado uma vez que ele pode travar o sistema operacional se utilizado em ambientes sem restrições de recurso. |
| :--- | :--- |


Para executar esse comando dentro do container, vamos primeiro adaptar nossa aplicação. Crie um novo arquivo dentro do github com nome de `forkbomb.php` e adicione o conteúdo desse arquivo nele:

```text

$output = shell_exec("while :; do _+=( $((++__)) ); done");
?>
```

### Testando o uso dos recursos <a id="user-content-testando-o-uso-dos-recursos"></a>

Agora abra a URL da nossa aplicação e adicione no final da url `/forkbomb.php`

### Acompanhando o consumo de recursos <a id="user-content-acompanhando-o-consumo-de-recursos"></a>

Podemos acompanhar o uso de recursos da aplicação pela Web Console do Openshift.

Clique sob o círculo do `workshop-ocp` conforme imagem abaixo:

Você deverá cair na página que mostra o uso de recursos da nossa aplicação.

O uso de CPU e memória não devem passar do que limitamos no início desse lab.

