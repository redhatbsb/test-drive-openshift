# 2.6 - s2i a partir de Dockerfile

[Permalink](https://github.com/redhatbsb/test-drive-openshift/blob/8ce43c5cb511571d907947f2d78a595d00910586/parte-2-openshift-4x/usando-dockerfile.adoc)

Cannot retrieve contributors at this time

 136 lines \(83 sloc\) 5.07 KB

## Usando Dockerfile <a id="user-content-usando-dockerfile"></a>

### Introdução <a id="user-content-introdu&#xE7;&#xE3;o"></a>

O Openshift permite realiza o build de `Dockerfile` para você. Basta adicionar o seu `Dockerfile` em um repositório git e informar ao Openshift que iremos utilizar a estratégia de build do tipo docker.

### Criando novo repositório no github <a id="user-content-criando-novo-reposit&#xF3;rio-no-github"></a>

Crie um repositório no github com o nome de `workshop-ocp`

[![image](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_237.png)](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_237.png)

Depois informe o nome do repositório:

[![image](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_239.png)](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_239.png)

```text
https://github.com//workshop-ocp.git
```

### Criando nosso Dockerfile <a id="user-content-criando-nosso-dockerfile"></a>

Abaixo segue o conteúdo do `Dockerfile`:

```text
FROM registry.access.redhat.com/rhscl/php-70-rhel7

RUN echo "Meu Dockerfile" > /opt/app-root/src/index.php

CMD ["container-entrypoint", "/usr/libexec/s2i/run"]
```

[![image](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_240.png)](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_240.png)

O conteúdo do arquivo fica assim:

| Note |  Repare que o nome do arquivo deve ser `Dockerfile` com o **D** maiúsculo. |
| :--- | :--- |


[![image](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_249.png)](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_249.png)

Realize o commit

[![image](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_242.png)](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_242.png)

Nosso repositório agora tem um novo arquivo:

[![image](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_250.png)](https://raw.githubusercontent.com/guaxinim/test-drive-openshift/master/gitbook/assets/selection_250.png)

| Note |  Ignore o arquivo `index.php` que você deve ter visto na imagem acima. Ele será criado em um outro lab posterior |
| :--- | :--- |


#### Usando a git pela linha de comando <a id="user-content-usando-a-git-pela-linha-de-comando"></a>

Também podemos salvar esse arquivo com nome de **Dockerfile** na raiz do nosso git executando comandos pelo bash:

```text
git add Dockerfile
git commit -m "Dockerfile adicionado"
git push
```

### Construindo o Dockerfile pela Web Console <a id="user-content-executando-o-dockerfile-com-openshift"></a>

### Construindo o Dockerfile pela CLI <a id="user-content-construindo-o-dockerfile-pela-cli"></a>

Para criar uma aplicação com base no Dockerfile, precisamos executar o seguinte comando:

```text
oc new-app \
 --name=dockerfile-app \
 --strategy=docker \
 https://github.com/<seu-usuario-do-github>/workshop-ocp.git
```

O valor default para o parametro **strategy** é **source.** Isso indica que, por padrão, o Openshift irá analisar o repositório git tentando compilar o código fonte da aplicação e usar o source-to-image. No nosso caso, queremos que ele use somente o Dockerfile e ignore o código fonte. Por isso informamos o parametro **–strategy=docker**

Assim que executamos o comando, o Openshift inicia o novo build.

A diferença desse build para o source-to-image executando anteriormente, é que nesse caso o Openshift está construindo nossa imagem Docker usando Dockerfile. Se acessarmos o log do build, podemos ver ae execução do nosso código.

### Limpando nosso lab <a id="user-content-limpando-nosso-lab"></a>

Vamos apagar nossa aplicação criada com base no Dockerfile. Dessa forma, deixaremos nosso Openshift limpo, organizado e pronto para o próximo lab.

```text
oc delete all -l app=workshop-ocp && oc delete secrets workshop-ocp-generic-webhook-secret workshop-ocp-github-webhook-secret
```

